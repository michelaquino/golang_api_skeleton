version: '2'
services:
    nginx: 
        build: ./docker/nginx
        ports:
            - 80:80
        depends_on:
            - api
    api:
        build: .
        depends_on:
            - mongodb
            - redis
        environment:
            API_HOST_PORT: 8888
            LOG_LEVEL: debug
            LOG_FILE_NAME: api.log
            LOG_TO_FILE: "false"
            NEW_RELIC_IS_ENABLED: "false"
            NEW_RELIC_LICENSE_KEY: key
            NEW_RELIC_PROXY_URL: http://newrelicproxy.com
            MONGO_URL: mongodb 
            MONGO_PORT: 27017 
            MONGO_TIMEOUT: 60
            MONGO_DATABASE_NAME: api
            REDIS_URL: redis
    mongodb:
        image: mongo:3.2.10
    redis:
        image: redis:6
    prometheus:
        image: prom/prometheus
        container_name: prometheus
        volumes:
            - ./prometheus.yml:/etc/prometheus/prometheus.yml
        command:
            - '--config.file=/etc/prometheus/prometheus.yml'
        ports: 
            - 9090:9090